---
title: "TO 414 Group Project 1"
author: "Shibi Sanjeev, Bryan Yu, Anthony Zhao, Ben Smith, Jackson Rocke"
date: "2/10/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Group Project 1: Due on 2/21

Look at resort vs city hotel

What role do meals play?
  
average daily rate by distribution channel



https://www.kaggle.com/jessemostipak/hotel-booking-demand

```{r}
hotel_data = read.csv("hotel_bookings.csv")

hotel_data$arrival_date_year = as.factor(hotel_data$arrival_date_year)
hotel_data$arrival_date_month = as.factor(hotel_data$arrival_date_month)
hotel_data$arrival_date_week_number = as.factor(hotel_data$arrival_date_week_number)
hotel_data$arrival_date_day_of_month = as.factor(hotel_data$arrival_date_day_of_month)
```



```{r}
library(tidyverse)
hotel_data$total_reservations = hotel_data$previous_bookings_not_canceled + hotel_data$previous_cancellations
```


## Make Factors 
```{r}
#summary(hotel_data)
#head(hotel_data)

# Factor needed variables
hotel_data$is_canceled = as.factor(hotel_data$is_canceled)
hotel_data$is_repeated_guest = as.factor(hotel_data$is_repeated_guest)
hotel_data$company = as.factor(hotel_data$company)
hotel_data$hotel = as.factor(hotel_data$hotel)
hotel_data$arrival_date_month = as.factor(hotel_data$arrival_date_month)
hotel_data$country = as.factor(hotel_data$country)
hotel_data$market_segment = as.factor(hotel_data$market_segment)
hotel_data$distribution_channel = as.factor(hotel_data$distribution_channel)
hotel_data$reserved_room_type = as.factor(hotel_data$reserved_room_type)
hotel_data$assigned_room_type = as.factor(hotel_data$assigned_room_type)
hotel_data$agent = as.factor(hotel_data$agent)
hotel_data$reservation_status_date = as.factor(hotel_data$reservation_status_date)
hotel_data$reservation_status = as.factor(hotel_data$reservation_status)
hotel_data$customer_type = as.factor(hotel_data$customer_type)
hotel_data$deposit_type = as.factor(hotel_data$deposit_type)

```


**Basic Data Structure**
```{r}
#str(hotel_data)
```

### **Cancellations**

An important initial note. We don't have the data for every month in every year. In 2016, we have data for all three months. In 2017, we have data from January until August. In 2015, we only have data from July to December. The only months with three years of data are July and August. All other months only have two years worth of data from either 2015 and 2016 or 2016 and 2017.

**Number of cancellations broken down by year and month**
```{r}
#This new column month_num has the month of the arrival at the hotel, similar to the arrival_date_month column. However, this one is in numerical form. This helps us with graphing. 
hotel_data$month_num = match(hotel_data$arrival_date_month, month.name)

#Number of cancellations broken down by year then month
res_breakdown_by_year_month = group_by(hotel_data, arrival_date_year, month_num, is_canceled) %>%
  summarize(num_reservations = n())

ggplot(res_breakdown_by_year_month, aes(x = month_num, y = num_reservations)) +
  geom_bar(aes(fill = as.factor(is_canceled)),stat = "identity") +
  facet_wrap(~arrival_date_year) +
  scale_x_continuous(name="Month", breaks = seq(0,12, 1)) +
  scale_fill_discrete(name = "", labels = c("Not Canceled", "Canceled")) +
  ggtitle("Number of Cancellations and Reservations in Each Year For Each Month") +
  theme(plot.title = element_text(hjust = 0.5))
```

**Percent of Reservations Canceled in Each Year and Month**
```{r}
#Number of reservations canceled by year, and month
t = hotel_data %>%
  group_by(arrival_date_year, month_num) %>%
  summarize(num_reservations_made = n()) %>%
   arrange(desc(arrival_date_year, month_num))

#Num reservations by year, and month
t1 = hotel_data %>%
  group_by(arrival_date_year, month_num, is_canceled) %>%
  summarize(num_reservations = n()) %>%
  arrange(arrival_date_year, month_num)

#Duplicating the dataframe t so that it can bind with dataframe t1
t2 = rbind(t, t) %>%
  arrange(arrival_date_year, month_num)

#Final Dataframe
t4 = (cbind(t1, t2) %>%
  select(arrival_date_year, month_num, is_canceled, num_reservations, num_reservations_made) %>%
  mutate(percent_reservations = num_reservations/num_reservations_made))

#Generating Bargraph
ggplot(t4, aes(x = month_num, y = percent_reservations)) +
  geom_bar(aes(fill = as.factor(is_canceled)),stat = "identity") +
  facet_wrap(~arrival_date_year) +
  scale_x_continuous(name="Month", breaks = seq(0,12, 1)) +
  scale_y_continuous(name="Percent of Reservations") + 
  scale_fill_discrete(name = "", labels = c("Not Canceled", "Canceled")) +
  ggtitle("Percent of Reservations Canceled or Not Cancelled \n in Each Year For Each Month") +
  theme(plot.title = element_text(hjust = 0.5))
```


**Percent of Reservations Canceled in Each Year and Month Broken Down By Hotel Type**
```{r}
#Number of reservations canceled by hotel type, year, and month
t1 = hotel_data %>%
  group_by(hotel, arrival_date_year, month_num, is_canceled) %>%
  summarize(num_reservations = n()) %>%
  arrange(hotel, arrival_date_year, month_num)

#Num reservations by hotel type, year, and month
t = hotel_data %>%
  group_by(hotel, arrival_date_year, month_num) %>%
  summarize(num_reservations_made = n()) %>%
   arrange(desc(hotel, arrival_date_year, month_num))

#Duplicating the dataframe t so that it can bind with dataframe t1
t2 = rbind(t, t) %>%
  arrange(hotel, arrival_date_year, month_num)

#Final Dataframe
t4 = (cbind(t1, t2) %>%
  select(hotel, arrival_date_year, month_num, is_canceled, num_reservations, num_reservations_made) %>%
  mutate(percent_reservations = num_reservations/num_reservations_made))

#Generating Bargraph
ggplot(t4, aes(x = month_num, y = percent_reservations)) +
  geom_bar(aes(fill = as.factor(is_canceled)),stat = "identity") +
  facet_grid(hotel ~ arrival_date_year) +
  scale_x_continuous(name="Month", breaks = seq(0,12, 1)) +
  scale_y_continuous(name="Percent of Reservations") + 
  scale_fill_discrete(name = "", labels = c("Not Canceled", "Canceled")) +
  ggtitle("Percentage of Reservations Canceled or Not Canceled \n in Each Year For Each Month by Hotel") +
  theme(plot.title = element_text(hjust = 0.5))
```

**Lead Time and Cancellations**
```{r}
#How many cancelations per days of lead time
group_by(hotel_data, is_canceled, lead_time) %>%
  summarize(count = n())

#Histograms of lead time by whether or not there were cancellations.
filter(hotel_data, lead_time < 600) %>%
ggplot(aes(x = lead_time)) +
  geom_histogram() +
  facet_wrap(~is_canceled)
```

**Length of Stay**
After calculating the total length of stay, we show the total length of stay with basic descriptive statistics and a histogram. We can see that the mean and median are 3.428 and 3 days respectively.
```{r}
#Total length of stay
hotel_data$total_stay = hotel_data$stays_in_week_nights + hotel_data$stays_in_weekend_nights

summary(hotel_data$total_stay)

filter(hotel_data, total_stay < 20) %>%
ggplot(aes(x = total_stay)) +
  geom_histogram(binwidth = 1) +
  geom_vline(aes(xintercept = mean(total_stay)), color = "lightblue") +
  geom_vline(aes(xintercept = median(total_stay)), color = "navy")
```

**Cancellations and Market Segment**
```{r}
#Number of reservations by market segment
a = group_by(hotel_data, market_segment) %>%
  summarize(total_reservations = n())

#Number of uncanceled reservations by market segment
b = filter(hotel_data, is_canceled == 0)  %>%
group_by(market_segment) %>%
  summarize(number_uncanceled_reservations = n())

#Number of canceled reservations by market segment
c = filter(hotel_data, is_canceled == 1)  %>%
group_by(market_segment) %>%
  summarize(number_canceled_reservations = n())

reservations = merge(a, b, by="market_segment") %>%
  merge(c, by = "market_segment") %>%
  mutate(percent_canceled = number_canceled_reservations/total_reservations) %>%
  select(market_segment, percent_canceled, total_reservations, number_uncanceled_reservations, number_canceled_reservations) %>%
  rename(
    number_uncanceled = number_uncanceled_reservations,
    number_canceled = number_canceled_reservations
  )

reservations
```

**Average Daily Rate and Number of Adults**
We can see that as the number of adults in a booking increases through reservations of four adults, the average daily rate also increases. There are reservations with more than 4 people, but there are not enough to generate boxplots. 
```{r}
filter(hotel_data, adr < 1000, adults < 5) %>%
ggplot(aes(x = as.factor(adults), y = adr)) +
  geom_boxplot()

filter(hotel_data, adr < 1000, children < 10) %>%
  ggplot(aes(x = as.factor(children), y = adr)) +
  geom_boxplot()
```

**Average Daily Rate and Month**
```{r}
#Average Daily Rate by Month
group_by(hotel_data, month_num) %>%
  summarize(avg_adr = mean(adr, na.rm = TRUE))
```

```{r}
ggplot(data = hotel_data, aes(x = month_num)) +
  geom_bar() +
  scale_x_continuous(name="Month", breaks = seq(0,12, 1))
```

## Hotel By Country
```{r}
hotel_data$country = match(hotel_data$reservation_status,hotel_data$country )
num_cancellations_by_country = group_by(hotel_data, hotel_data$country, is_canceled)
summarize(num_cancellations_by_country)

```

```{r}
 #git config --global user.email "tahmoush@umich.edu"
#git config --global user.name "Benjamin Tahmoush"
```


```{r}
#ggplot(num_cancellations_by_country, aes(x = country, y = num_cancellations)) +
#  geom_bar(aes(fill = as.factor(is_canceled)),stat = "identity") +
#  facet_wrap(~arrival_date_year) +
#  scale_x_continuous(name="Country", breaks = seq(0,12, 1)) +
#  scale_fill_discrete(name = "", labels = c("Not Canceled", "Canceled")) +
#  ggtitle("Number of Cancellations and Reservations in Each Country") +
#  theme(plot.title = element_text(hjust = 0.5))
```









